<html>
<head>
<title>Magazine</title>
<link rel="stylesheet" href="magazine.css">
<script src="jquery.js"></script>
<script src="jquery.touchSwipe.js"></script>
<script src="jstorage.js"></script>

<script src="magazine.js"></script>

<script>

$(document).ready(function(){

	if(DEBUG){
		$('.splash').click(function(){
			$('.splash').fadeOut()
		})
	}


	$(window)
		.resize(function() {
			fitNPages(PAGES_VISIBLE)
		})
		.bind('hashchange', function(e){
			e.preventDefault()
			setCurrentPage(loadURLState())
		})

	$('.viewer')
		.swipe({
			swipeStatus: swipeUpdate,
			// XXX change this to pinch...
			swipeUp: function(){
				//togglePageView('off')
				togglePageView()
			},
			// XXX change this to pinch...
			swipeDown: function(){
				//togglePageView('on')
				togglePageView()
			},

			pinchIn: function(event, direction, distance, duration, fingerCount, pinchZoom) {
				if(pinchZoom < distance){
					return
				}
				if(fingerCount == 2){
					togglePageView('on')
				}
			},
			pinchOut: function(event, direction, distance, duration, fingerCount, pinchZoom) {
				if(pinchZoom < distance){
					return
				}
				if(fingerCount == 2){
					togglePageView('off')
				}
			},


			// XXX for some reason this deos not bubble up the nested elements...
			click: function(evt, elem){
				if($(elem).hasClass('page')){
					setCurrentPage(elem)
					//togglePageView('on')
				} else if($(elem).hasClass('content')){
					setCurrentPage($(elem).parents('.page').first())
					//togglePageView('on')
				}
				return true
			},

			fingers: $.fn.swipe.fingers.ALL
		})
	$('.button.cover').swipe({click: goToMagazineCover})
	$('.button.next-article').swipe({click: nextArticle})
	$('.button.prev-article').swipe({click: prevArticle})

	loadState()

	togglePageView('on')

	// hide the splash screen...
	$(window).one('webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend',
		function(){
			$('.splash').fadeOut()
		})
})


</script>
</head>
<body>

<div class="viewer">

	<!-- Splash screen -->
	<div class="splash noSwipe">
		<!-- XXX replace this with a background-image logo... -->
		<table width="100%" height="100%"><tr><td align="center" valign="middle">
			<h2><i>loading...</i></h2>
		</td></tr></table>
	</div>


	<!-- XXX Magazine title... -->

	<div class="top-toolbar">
		<div class="button cover">Issue Cover</div>
		<div class="button prev-article">Prev Article</div>
		<div class="button next-article">Next Article</div>
	</div>
	<div class="bottom-toolbar">
		<!-- this is just an example-->
		<a href="#home">Cover</a> |
		<a href="#prevArticle">Previous article</a> |
		<a href="#prev">Previous page</a> |
		<a href="#next">Next page</a> | 
		<a href="#nextArticle">Next article</a> |
		<a href="#end">End</a>
	</div>

<div class="scaler">
<div class="aligner">
	<div class="magazine">
		<div class="cover page current">
			<div class="content">
				<h1>Magazine Cover</h1>
				<h2>Navigation via #URLs</h2>
				<h3>The basics</h3>
				<a href="#1">Page #1</a><br>
				<a href="#ArticleAnchorExample">Named page</a><br>
				<p>
					<a href="#page-3-anchor">Anchor on page #3</a><br>
					<i>BUG: currently navigation via existing anchors
						will break the layout, so use the name attribute
						on any other tags (see example).
					</i>
				</p>

				<h3>Special anchors</h3>
				<p>These show up in the page URL</p>
				<a href="#home">Magazine cover</a><br>
				<a href="#end">Last page</a><br>
				<a href="#thumbnails">Thumbnail view</a><br>
				<a href="#example-layer">Toggle a hidden layer</a><br>
				<span name="example-layer" class="hidden">
					<a href="#hideLayers">Hide all layers</a><br>
				</span>

				<h3>Relative special anchors</h3>
				<p>These will get replaced by corresponding page numbers in the URL</p>
				<a href="#next">Next page</a><br>
				<a href="#prev">Previous page</a><br>
				<a href="#nextArticle">Next article</a><br>
				<a href="#prevArticle">Previous article</a><br>

				<div name="example-layer" class="hidden" onclick="window.location.hash='example-layer'" style="position:absolute; left:400px; top:250px; width: 250px; height:50px; text-align: center; padding: 15px; border: solid gray 5px; background: silver; color: white">
					This is an example layer<br><br>
					<i>click or tap to hide</i>
				</div>
			</div>
		</div>

		<!-- XXX do we need a Magazine Credits page??? -->

		<div class="article">
			<div class="cover page">
				<div class="content">
					<h1>Article Cover</h1>
					<a href="#home">home</a><br>
					some more text...
				</div>
			</div>

			<!-- XXX do we need an Article Credits page??? -->

			<div class="page">
				<div class="content" style="border:solid red 1px">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					<a name="page-3-anchor"></a>
					Page
					<img src="img.jpg" height="100%"/>
				</div>
			</div>
			<div class="page">
				<div class="content">
					<img src="img.jpg" width="200%" style="margin-left: -50%; margin-top: -20%"/>
				</div>
			</div>
		</div>
		<div class="article">
			<div class="cover page">
				<div class="content" name="ArticleAnchorExample">
					<!--a name="ArticleAnchorExample"></a-->
					<h1>Article Cover</h1>
					<a href="#home">home</a><br>
				</div>
			</div>

			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
		</div>
		<div class="article">
			<div class="cover page">
				<div class="content">
					<h1>Article Cover</h1>
					<a href="#home">home</a><br>
				</div>
			</div>

			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page
				</div>
			</div>
			<div class="page">
				<div class="content">
					Page<br>
					<a href="#home">home</a><br>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
</div>


</body>
</html>
